<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡¶ö‡ßÇ‡¶°‡¶º‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</title>
  <style>
    body {
      font-family: 'Siyam Rupali', sans-serif;
      background: #fffdee;
      padding-left:60px;
      padding-right:60px;
      max-width: 98%;
      margin: auto;
    }
    h2, h3 {
      text-align: center;
      color: #333;
    }
    .filter-area {
      text-align: center;
      margin: 20px 0;
    }
    .filter-area input, .filter-area select {
      padding: 5px 10px;
      margin: 5px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background-color: #007f5f;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f7f7f7;
    }
    .print-buttons {
      text-align: center;
      margin-top: 20px;
    }
    button {
      padding: 6px 12px;
      font-size: 14px;
      margin: 0 5px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    .print-btn { background: #28a745; color: white; }
    .excel-btn { background: #007bff; color: white; }
    @media print {
      .filter-area, .print-buttons { display: none !important; }
      th { background-color: #007f5f !important; color: white !important; }
    }

    .institute-header {
      text-align: center;
      margin-bottom: 10px;
      margin-top: 10px;
      font-family: 'Siyam Rupali', sans-serif;
    }

    .institute-header .logo {
      width: 100px;
      height: auto;
      vertical-align: middle;
      margin-bottom: 0px;
    }

    .institute-header h1 {
      color: #007f5f;
      margin: 5px 0 2px 0;
      font-size: 24px;
    }

    .institute-header h3 {
      color: #555;
      margin: 2px 0 10px 0;
      font-size: 16px;
      font-weight: normal;
    }
  </style>
</head>
<div style="text-align: center; margin: 20px 0;">
  <a href="https://hasanbdt.github.io/daily-st-report/" style="margin: 0 10px;">üì• ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ</a>
  <a href="https://hasanbdt.github.io/daily-st-report/list" style="margin: 0 10px;">üìã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶Æ‡ßç‡¶Æ‡¶ø‡¶≤‡¶ø‡¶§</a>
  <a href="https://hasanbdt.github.io/daily-st-report/list-final" style="margin: 0 10px;">‚≠ê ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ö‡ßÅ‡ßú‡¶æ‡¶®‡ßç‡¶§</a>
  <a href="https://hasanbdt.github.io/daily-st-report/edit" style="margin: 0 10px;">‚úèÔ∏è ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶è‡¶°‡¶ø‡¶ü</a>
</div>

<body>
  <div class="institute-header">
    <img src="epi.png" alt="Logo" class="logo" />
    <h1>‡¶á‡¶™‡¶ø‡¶Ü‡¶á ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø, ‡¶¢‡¶æ‡¶ï‡¶æ</h1>
    <h3>‡¶∏‡ßç‡¶¨‡¶™‡ßç‡¶® ‡¶™‡ßÇ‡¶∞‡¶£‡ßá ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶∞ ‡¶™‡¶•‡ßá...</h3>
  </div>

  <h3>üìã ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßÇ‡¶°‡¶º‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h3>

  <div class="filter-area">
    <input type="date" id="filterDate">
    <input type="text" id="filterName" placeholder="‡¶®‡¶æ‡¶Æ">
    <select id="filterClass">
      <option value="">‡¶∏‡¶¨ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
      <option value="One">One</option>
      <option value="Two">Two</option>
      <option value="Three">Three</option>
      <option value="Four">Four</option>
      <option value="Five">Five</option>
      <option value="Six">Six</option>
      <option value="Seven">Seven</option>
      <option value="Eight">Eight</option>
    </select>
    <button onclick="filterData()">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <button onclick="showAll()">‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®</button>
  </div>

  <table id="finalTable">
    <thead>
      <tr>
        <th>‡¶®‡¶æ‡¶Æ</th>
        <th>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏</th>
        <th>‡¶∞‡ßã‡¶≤</th>
        <th>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th>
        <th>‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p style= "font-size:15px; color: red; text-align: center;">‡¶¶‡ßÇ‡¶∞‡ßç‡¶≠‡¶æ‡¶ó‡ßç‡¶Ø ‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø; ‡¶Ø‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡¶ü‡¶ø ‡¶ó‡¶§‡¶ï‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶Æ ‡¶π‡¶≤‡ßã ‡¶®‡¶æ‡•§</p>

  <div class="print-buttons">
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü PDF</button>
    <button class="excel-btn" onclick="exportToExcel()">üì• ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwKp_6znRl7TkIpXa3uFuZGOUxSHnkHOM",
      authDomain: "dailyreport-9512d.firebaseapp.com",
      databaseURL: "https://dailyreport-9512d-default-rtdb.firebaseio.com",
      projectId: "dailyreport-9512d",
      storageBucket: "dailyreport-9512d.appspot.com",
      messagingSenderId: "469725849063",
      appId: "1:469725849063:web:3d82a4560478d1b11f8942"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const scoreMap = {
      dayFeeling: {"üòÉ ‡¶ñ‡ßÅ‡¶¨ ‡¶≠‡¶æ‡¶≤‡ßã": 1, "üôÇ ‡¶Æ‡ßã‡¶ü‡¶æ‡¶Æ‡ßÅ‡¶ü‡¶ø": 0.5, "üòê ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™": 0},
      learned: {"üìò ‡¶®‡¶§‡ßÅ‡¶® ‡¶¶‡ßã‡ßü‡¶æ/‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞": 1, "üìó ‡¶ï‡ßã‡¶∞‡¶Ü‡¶®‡ßá‡¶∞ ‡¶Ü‡ßü‡¶æ‡¶§/‡¶ó‡ßÄ‡¶§‡¶æ‡¶∞ ‡¶∂‡ßç‡¶≤‡ßã‡¶ï": 1, "üìô ‡¶ó‡¶£‡¶ø‡¶§/‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®": 0.7, "üìï ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶Ü‡¶¶‡¶¨/‡¶ß‡¶∞‡ßç‡¶Æ‡ßÄ‡ßü ‡¶Ü‡¶¶‡¶¨": 1, "ü§∑ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∂‡¶ø‡¶ñ‡¶ø‡¶®‡¶ø": 0},
      goodDeed: {"üïå ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú ‡¶™‡ßú‡¶ø‡ßü‡ßá‡¶õ‡¶ø/‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡¶®‡¶æ ‡¶ï‡¶∞‡¶ø‡ßü‡ßá‡¶õ‡¶ø": 1, "üëê ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø": 1, "üòä ‡¶≠‡¶æ‡¶≤‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø": 0.7, "üòá ‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶¨‡¶≤‡¶ø‡¶®‡¶ø": 0.7, "üôÅ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ï‡¶∞‡¶ø‡¶®‡¶ø": 0},
      mistake: {"‚úÖ ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡ßÅ‡¶≤ ‡¶ï‡¶∞‡¶ø‡¶®‡¶ø": 1, "üôä ‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶¨‡¶≤‡ßá‡¶õ‡¶ø": 0, "üò° ‡¶∞‡¶æ‡¶ó ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø": 0.3, "üìö ‡¶™‡ßú‡¶æ ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø": 0.3, "üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¶‡ßá‡¶ñ‡ßá‡¶õ‡¶ø": 0.2},
      lovedPerson: {"üë© ‡¶Æ‡¶æ": 1, "üë® ‡¶¨‡¶æ‡¶¨‡¶æ": 1, "üë®‚Äçüè´ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï": 0.75, "üëß ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ": 0.5, "ü§ê ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶¨‡¶≤‡¶ø‡¶®‡¶ø": 0},
      thoughtAbout: {"üïã ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π/‡¶∏‡ßç‡¶∞‡¶∑‡ßç‡¶ü‡¶æ": 1, "üìñ ‡¶™‡ßú‡¶æ‡¶≤‡ßá‡¶ñ‡¶æ": 0.8, "‚öΩ ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ß‡ßÅ‡¶≤‡¶æ": 0.5, "üò¥ ‡¶ò‡ßÅ‡¶Æ/‡¶Ö‡¶≤‡¶∏‡¶§‡¶æ": 0.2, "üôÇ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ": 0},
      prayerTimes: {"üïã ‡ß´ ‡¶¨‡¶æ‡¶∞": 1, "üïå ‡ß©-‡ß™ ‡¶¨‡¶æ‡¶∞": 0.6, "üòï ‡ßß-‡ß® ‡¶¨‡¶æ‡¶∞": 0.3, "üôÅ ‡ßß ‡¶¨‡¶æ‡¶∞‡¶ì ‡¶®‡¶æ": 0},
      rememberAllah: {"üîü ‡ßß‡ß¶ ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø": 1, "‚ûê ‡ß´-‡ßß‡ß¶ ‡¶¨‡¶æ‡¶∞": 0.7, "‚ûå ‡ßß-‡ß™ ‡¶¨‡¶æ‡¶∞": 0.3, "üôÅ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡¶ì ‡¶®‡¶æ": 0}
    };

    function calculateStars(item) {
      let total = 0;
      for (let key in scoreMap) {
        let answer = item[key] || '';
        let value = scoreMap[key][answer] || 0;
        total += value;
      }
      return {
        score: total,
        stars: Math.round((total / 8) * 5)
      };
    }

    function renderStars(n) {
      return "‚≠ê".repeat(n) + "‚òÜ".repeat(5 - n);
    }

    function loadData(filter = {}) {
      db.ref("dailyReports").once("value").then(snap => {
        const data = snap.val();
        const tbody = document.querySelector("#finalTable tbody");
        tbody.innerHTML = "";
        if (data) {
          Object.values(data).forEach(item => {
            if (
              (!filter.date || new Date(item.timestamp).toISOString().split("T")[0] === filter.date) &&
              (!filter.name || item.studentName.includes(filter.name)) &&
              (!filter.class || item.studentClass === filter.class)
            ) {
              const { score, stars } = calculateStars(item);
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${item.studentName}</td>
                <td>${item.studentClass}</td>
                <td>${item.studentRoll}</td>
                <td>${score.toFixed(2)}</td>
                <td>${renderStars(stars)}</td>
              `;
              tbody.appendChild(tr);
            }
          });
        }
      });
    }

    function filterData() {
      const date = document.getElementById("filterDate").value;
      const name = document.getElementById("filterName").value.trim();
      const studentClass = document.getElementById("filterClass").value;
      loadData({ date, name, class: studentClass });
    }

    function showAll() {
      document.getElementById("filterDate").value = "";
      document.getElementById("filterName").value = "";
      document.getElementById("filterClass").value = "";
      loadData();
    }

    function exportToExcel() {
      const table = document.getElementById("finalTable");
      const html = table.outerHTML.replace(/ /g, '%20');
      const link = document.createElement('a');
      link.href = 'data:application/vnd.ms-excel,' + html;
      link.download = 'FinalReport.xls';
      link.click();
    }

    loadData();
  </script>
</body>
</html>
